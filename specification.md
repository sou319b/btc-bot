# Bybit 自動取引ボット 仕様書

## 1. システム概要

このシステムは、Bybitの暗号資産取引所でBTC/USDTペアの自動取引を行うボットです。
価格変動に基づいて自動的に売買を行い、利益を追求します。

### 1.1 主な機能
- BTCの価格監視
- 資産（USDT、BTC）の残高管理
- 価格変動に基づく自動売買
- リアルタイムの取引情報表示
- 損益計算と表示

### 1.2 システム構成
システムは以下の2つのモジュールで構成されています：

1. `bybit_handler.py`: Bybit APIとの通信を担当
2. `trading_logic.py`: 取引ロジックと表示を担当

## 2. モジュール詳細

### 2.1 bybit_handler.py

#### 2.1.1 概要
Bybit取引所のAPIとの通信を担当するモジュールです。

#### 2.1.2 クラス: BybitHandler
APIとの通信に関する全ての機能を提供します。

##### メソッド
1. `__init__()`
   - 機能：Bybit APIクライアントの初期化
   - 環境変数の読み込み
   - テストネットへの接続設定

2. `get_btc_price()`
   - 機能：BTCの現在価格を取得
   - 戻り値：float型の価格、またはエラー時はNone

3. `get_wallet_info()`
   - 機能：USDT残高とBTC保有量を取得
   - 戻り値：(USDT残高, BTC保有量)のタプル

4. `place_buy_order(qty)`
   - 機能：指定数量のBTC買い注文を実行
   - 引数：qty (購入するBTCの量)
   - 戻り値：注文情報、またはエラー時はNone

5. `place_sell_order(qty)`
   - 機能：指定数量のBTC売り注文を実行
   - 引数：qty (売却するBTCの量)
   - 戻り値：注文情報、またはエラー時はNone

### 2.2 trading_logic.py

#### 2.2.1 概要
取引ロジックと情報表示を担当するモジュールです。

#### 2.2.2 クラス: TradingBot
自動取引の実行と情報表示を行います。

##### メソッド
1. `__init__()`
   - 機能：TradingBotの初期化
   - BybitHandlerのインスタンス作成
   - 初期値の設定

2. `print_trade_info()`
   - 機能：取引情報の表示
   - 表示内容：
     - 現在時刻
     - BTC価格
     - USDT残高
     - BTC保有量
     - 総資産額
     - 損益情報（金額・パーセンテージ）

3. `initialize()`
   - 機能：取引開始前の初期化処理
   - 初期価格の取得
   - 初期資産の計算
   - 初期情報の表示

4. `execute_trade()`
   - 機能：取引ロジックの実行
   - 動作間隔：3秒
   - 取引条件：
     - 買い：価格が0.1%下落時
     - 売り：価格が0.1%上昇時
   - 取引金額：1回あたり50 USDT
   - 最小取引量：0.001 BTC

## 3. 取引ロジック

### 3.1 価格監視
- 3秒ごとに価格をチェック
- 基準価格（best_price）との比較で変動率を計算

### 3.2 売買条件
1. 買い注文条件
   - 現在価格が基準価格から0.1%以上下落
   - 注文金額：50 USDT固定

2. 売り注文条件
   - 現在価格が基準価格から0.1%以上上昇
   - 注文金額：50 USDT固定

### 3.3 注文サイズ調整
- 最小取引量：0.001 BTC
- 計算された取引量が最小値未満の場合は0.001 BTCに調整

## 4. 表示情報

### 4.1 価格情報
- 現在時刻
- 現在のBTC価格
- 基準価格からの変動率

### 4.2 取引情報
- USDT残高
- BTC保有量
- 総資産額（USDT換算）
- プログラム開始時からの損益
  - 金額（USDT）
  - パーセンテージ

## 5. エラー処理

### 5.1 価格取得エラー
- エラー発生時は1秒待機後に再試行
- エラーメッセージを表示

### 5.2 注文エラー
- エラーメッセージを表示
- 取引をスキップして次のサイクルへ

### 5.3 残高取得エラー
- エラー時は0として処理
- エラーメッセージを表示

## 6. 終了処理
- Ctrl+Cによる安全な終了をサポート
- 終了メッセージを表示 