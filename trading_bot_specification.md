# BTCトレーディングボット仕様書

## 1. システム概要

### 1.1 目的
- Bybitの現物取引市場でBTC/USDTペアの自動取引を行い、利益を得る
- 価格トレンドを監視し、適切なタイミングで売買を実行する

### 1.2 システム構成
- `p17_trading_logic.py`: メインの取引ロジックを実装
- `p16_bybit_handler.py`: Bybit APIとの通信を担当

## 2. 取引パラメータ

### 2.1 基本設定
- 最小取引額: 5 USDT
- 最大取引額: 50 USDT
- 最小BTC取引量: 0.00010 BTC
- 取引間隔: 30秒（ホールド時間）
- 情報表示間隔: 5秒

### 2.2 トレンド判定
- 価格履歴サイズ: 12（1分間の価格履歴）
- 下降トレンド判定: スコア < -0.25
- 上昇トレンド判定: スコア > 0.25
- トレンドスコア計算:
  - 短期変動（直近2点）: 70%の重み
  - 長期変動（1分間）: 30%の重み

## 3. 取引ロジック

### 3.1 買い注文条件
- 下降トレンド検出時（スコア < -0.25）
- USDT残高が最小取引額（5 USDT）以上
- 取引量調整:
  - 強い下降トレンド（>0.5）: 最大取引額（50 USDT）まで
  - 通常の下降トレンド: 最大取引額の70%まで

### 3.2 売り注文条件
- 上昇トレンド検出時（スコア > 0.25）
- BTC保有量あり
- BTC価値が最小取引額（5 USDT）以上
- 取引量調整:
  - 強い上昇トレンド（>0.5）: 全量売却
  - 通常の上昇トレンド: 保有量の70%を売却

## 4. 安全性機能

### 4.1 残高チェック
- 取引開始前の残高確認
- 注文実行直前の残高再確認
- 最小取引額のチェック
- 保有量を超える売り注文の防止

### 4.2 エラー処理
- API通信エラーの検出と記録
- 価格取得失敗時の再試行
- 残高不足時の取引スキップ
- 注文エラーのログ記録

## 5. ログ機能

### 5.1 取引情報記録
- 時刻
- BTC価格
- 価格変動率
- USDT残高
- BTC保有量
- 総資産額（USDT換算）
- 取引回数（買い/売り）
- 利益率

### 5.2 ログファイル
- 日時スタンプ付きのログファイル生成
- エラー情報の記録
- 取引実行の記録
- デバッグ情報の記録

## 6. 環境設定

### 6.1 必要な環境変数
- BYBIT_TEST_API_KEY: Bybitテストネット用APIキー
- BYBIT_TEST_SECRET: Bybitテストネット用シークレットキー

### 6.2 API設定
- テストネット使用
- 受信ウィンドウ: 5000ミリ秒
- サーバー時刻同期機能

## 7. 制限事項

### 7.1 取引制限
- 最小取引額: 5 USDT
- 最大取引額: 50 USDT
- 最小BTC取引量: 0.00010 BTC
- 取引間隔: 最低30秒

### 7.2 数値制限
- BTC数量: 小数点以下5桁に丸め
- USDT金額: 小数点以下2桁に丸め

## 8. 終了処理
- Ctrl+Cによる安全な終了
- 終了時のログ記録
- 実行中の取引の完了待ち 